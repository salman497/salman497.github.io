<mat-toolbar>
  <ng-container *ngIf="isLoggedIn$ | async">
    <img
      class="user-image"
      [src]="userImage$ | async"
      referrerpolicy="no-referrer"
      alt="User Image"
    />
    <span class="username">{{ userName$ | async }}</span>
    <button
      mat-raised-button
      class="toolbar-button"
      (click)="OnLogout()"
      aria-label="Login"
    >
      Sign Out
    </button>
  </ng-container>
  <span class="spacer"></span>
  <ng-container *ngIf="(isLoggedIn$ | async) === false">
    <button
      mat-raised-button
      class="toolbar-button"
      (click)="onLogin()"
      aria-label="Login"
    >
      Login
    </button>
  </ng-container>

  <button
    mat-raised-button
    (click)="onClose()"
    class="toolbar-button"
    aria-label="Close"
  >
    Close
  </button>
</mat-toolbar>
<div class="editor-container">
  <ng-container *ngIf="editor$ | async as editor">
  <mat-accordion>
    <!-- Editor Section -->
    <mat-expansion-panel [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title> <mat-icon>edit</mat-icon> Editor </mat-panel-title>
      </mat-expansion-panel-header>

      <mat-form-field class="editor-textarea-field">
        <mat-label>Edit markdown</mat-label>
        <textarea
          matInput
          class="editor-textarea"
          [ngModel]="editor.content"
          (ngModelChange)="onTextareaChange($event)"
        ></textarea>
      </mat-form-field>
    
    </mat-expansion-panel>

    <!-- Settings Section -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>settings</mat-icon> Settings
        </mat-panel-title>
      </mat-expansion-panel-header>
      <!-- Theme Dropdown -->
      <mat-form-field class="dropdown-field">
        <mat-label>Theme</mat-label>
        <mat-select [value]="editor.themeSelected" (valueChange)="updateTheme($event)">
          <mat-option *ngFor="let theme of themes" [value]="theme">{{
            theme
          }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Animation Dropdown -->
      <mat-form-field class="dropdown-field">
        <mat-label>Animation</mat-label>
        <mat-select
        [value]="editor.animationSelected"
          (valueChange)="updateAnimation($event)"
        >
          <mat-option
            *ngFor="let animation of animations"
            [value]="animation"
            >{{ animation }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <!-- Slide Toggles -->
      <div class="toggle-container">
        <mat-slide-toggle
          class="editor-mat-slide-toggle"
          [ngModel]="editor.showPen"
          (change)="updateShowPen($event)"
          aria-label="Show Pen"
          >Show Pen</mat-slide-toggle
        >
        <mat-slide-toggle
          class="editor-mat-slide-toggle"
          [(ngModel)]="editor.showDrawingArea"
          (change)="updateShowDrawingArea($event)"
          aria-label="Show Drawing Area"
          >Show Drawing Area</mat-slide-toggle
        >
        <mat-slide-toggle
          class="editor-mat-slide-toggle"
          [ngModel]="editor.showSlides"
          (change)="updateShowSlides($event)"
          aria-label="Show Slides"
          >Show Slides</mat-slide-toggle
        >
      </div>
    </mat-expansion-panel>

    <!-- Publish Section -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>publish</mat-icon> Publish
        </mat-panel-title>
      </mat-expansion-panel-header>
    
      <!-- Top Row -->
      <div class="top-row">
        <!-- Presentation Name Input -->
        <mat-form-field class="input-field presentation-input">
          <mat-label>Presentation Name</mat-label>
          <input
            matInput
            [ngModel]="name$ | async"
            (blur)="onPresentationNameChange($event)"
            pattern="[a-zA-Z0-9\s]*"
            placeholder="My presentation"
            #presentationName
          />
          <mat-error
            >Only alphanumeric characters, hyphens, and spaces are
            allowed.</mat-error
          >
        </mat-form-field>
    
        <!-- Publish Button -->
        <button
          mat-raised-button
          color="primary"
          class="publish-button"
          (click)="onPublish(presentationName.value)"
        >
          Publish
        </button>
      </div>

      <!-- Published view Url Input -->
      <mat-form-field class="input-field">
        <mat-label>Published view Url</mat-label>
        <input matInput [ngModel]= "viewUrl$ | async" #viewUrl readonly />
        <button
          mat-icon-button
          matSuffix
          (click)="copyToClipboard(viewUrl.value)"
          aria-label="Copy URL"
        >
          <mat-icon>content_copy</mat-icon>
        </button>
        <button
          mat-icon-button
          matSuffix
          (click)="openInNewTab(viewUrl.value)"
          aria-label="Open in new tab"
        >
          <mat-icon>open_in_new</mat-icon>
        </button>
      </mat-form-field>

      <!-- Published edit Url Input -->
      <mat-form-field class="input-field">
        <mat-label>Published edit Url</mat-label>
        <input matInput [ngModel]= "editUrl$ | async" #editUrl readonly />
        <button
          mat-icon-button
          matSuffix
          (click)="copyToClipboard(editUrl.value)"
          aria-label="Copy URL"
        >
          <mat-icon>content_copy</mat-icon>
        </button>
      </mat-form-field>
      <div class="toggle-container">
        <mat-slide-toggle
          class="editor-mat-slide-toggle"
          [ngModel]="allowEdit$ | async"
          (change)="onAllowEditChange($event)"
          [disabled]="(this.disabled$ | async)? true: false"
          aria-label="Allow Others to edit {{loginFeatureText$ | async}}"
          >Allow Others to edit {{loginFeatureText$ | async}}</mat-slide-toggle
        >
      </div>
      <!-- Load my presentation Dropdown -->
      <mat-form-field class="dropdown-field">
        <mat-label>Select Your Presentation {{loginFeatureText$ | async}}</mat-label>
        <mat-select
        #selectPresentation
        [(value)]="selectedPresentation"
        [disabled]="this.disabled$ | async"
        (selectionChange)="onPresentationSelected()"
        matTooltip="Your Presentation {{loginFeatureText$ | async}}"
      >
        <mat-option
          *ngFor="let presentation of userPresentations$ | async"
          [value]="presentation"
        >
          {{ presentation.name }}
        </mat-option>
      </mat-select>
      </mat-form-field>
      <button (click)="onDeleteButtonClick()" *ngIf="selectPresentation.value ? true: false">
        <mat-icon>delete</mat-icon>
      </button>
    </mat-expansion-panel>
  </mat-accordion>
</ng-container>
</div>